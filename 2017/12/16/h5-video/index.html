<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>视频H5 video标签最佳实践 - Gnipbao&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="随着 4G 的普遍以及 WiFi 的广泛使用，手机上的网速已经足够稳定和高速，以视频为主的 HTML5 也越来越普遍了，相比帧动画，视频的表现更加丰富，这里介绍一些实践经验。 video的属性12345678910111213141516&amp;lt;video  id=&quot;video&quot;   src=&quot;video.mp4&quot;   controls = &quot;true&quot;  poster=&quot;images.jpg&quot;">
<meta name="keywords" content="视频播放 H5 video">
<meta property="og:type" content="article">
<meta property="og:title" content="视频H5 video标签最佳实践">
<meta property="og:url" content="https://gnipbao.github.io/2017/12/16/h5-video/index.html">
<meta property="og:site_name" content="Gnipbao&#39;s blog">
<meta property="og:description" content="随着 4G 的普遍以及 WiFi 的广泛使用，手机上的网速已经足够稳定和高速，以视频为主的 HTML5 也越来越普遍了，相比帧动画，视频的表现更加丰富，这里介绍一些实践经验。 video的属性12345678910111213141516&amp;lt;video  id=&quot;video&quot;   src=&quot;video.mp4&quot;   controls = &quot;true&quot;  poster=&quot;images.jpg&quot;">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/16514704/25273844/2894bc8e-26c0-11e7-87f3-2a051d1e92b9.jpg">
<meta property="og:updated_time" content="2017-12-16T15:10:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="视频H5 video标签最佳实践">
<meta name="twitter:description" content="随着 4G 的普遍以及 WiFi 的广泛使用，手机上的网速已经足够稳定和高速，以视频为主的 HTML5 也越来越普遍了，相比帧动画，视频的表现更加丰富，这里介绍一些实践经验。 video的属性12345678910111213141516&amp;lt;video  id=&quot;video&quot;   src=&quot;video.mp4&quot;   controls = &quot;true&quot;  poster=&quot;images.jpg&quot;">
<meta name="twitter:image" content="https://cloud.githubusercontent.com/assets/16514704/25273844/2894bc8e-26c0-11e7-87f3-2a051d1e92b9.jpg">
  
    <link rel="alternative" href="/atom.xml" title="Gnipbao&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.ico">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo logo-text" href="/">Gnipbao</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/h5-test/menu.html">作品</a>
        
          <a class="main-nav-link" href="/me">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <!--<p>-->
            <!--<a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=6071b891d167a94217254d0d36cec8a338df210ca5831dd09950740807f5da97"><img border="0" src="http://pub.idqqimg.com/wpa/images/group.png" alt="前端联盟" title="前端联盟"></a>-->
          <!--</p>-->
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-h5-video" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      视频H5 video标签最佳实践
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/12/16/h5-video/" class="article-date">
  <time datetime="2017-12-16T15:10:00.000Z" itemprop="datePublished">2017-12-16</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/写作/">写作</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cloud.githubusercontent.com/assets/16514704/25273844/2894bc8e-26c0-11e7-87f3-2a051d1e92b9.jpg" alt="cover_900x500"><br>随着 4G 的普遍以及 WiFi 的广泛使用，手机上的网速已经足够稳定和高速，以视频为主的 HTML5 也越来越普遍了，相比帧动画，视频的表现更加丰富，这里介绍一些实践经验。</p>
<h3 id="video的属性"><a href="#video的属性" class="headerlink" title="video的属性"></a>video的属性</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"video"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">"video.mp4"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">controls</span> = <span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">poster</span>=<span class="string">"images.jpg"</span> /*视频封面*/</span></span><br><span class="line"><span class="tag">  <span class="attr">preload</span>=<span class="string">"auto"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">webkit-playsinline</span>=<span class="string">"true"</span> /*这个属性是<span class="attr">ios</span> <span class="attr">10</span>中设置可以</span></span><br><span class="line"><span class="tag">                     让视频在小窗内播放，也就是不是全屏播放*/  </span></span><br><span class="line"><span class="tag">  <span class="attr">playsinline</span>=<span class="string">"true"</span>  /*<span class="attr">IOS</span>微信浏览器支持小窗内播放*/ </span></span><br><span class="line"><span class="tag">  <span class="attr">x-webkit-airplay</span>=<span class="string">"allow"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">x5-video-player-type</span>=<span class="string">"h5"</span>  /*启用<span class="attr">H5</span>播放器,是<span class="attr">wechat</span>安卓版特性*/</span></span><br><span class="line"><span class="tag">  <span class="attr">x5-video-player-fullscreen</span>=<span class="string">"true"</span> /*全屏设置，</span></span><br><span class="line"><span class="tag">                     设置为 <span class="attr">true</span> 是防止横屏*/</span></span><br><span class="line"><span class="tag">  <span class="attr">x5-video-orientation</span>=<span class="string">"portraint"</span> //播放器支付的方向， <span class="attr">landscape</span>横屏，<span class="attr">portraint</span>竖屏，默认值为竖屏</span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">"object-fit:fill"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>src: 视频的地址</li>
<li>controls: 加上这个属性，Gecko 会提供用户控制，允许用户控制视频的播放，包括音量，跨帧，暂停/恢复播放。</li>
<li>poster: 属性规定视频下载时显示的图像，或者在用户点击播放按钮前显示的图像。如果未设置该属性，则使用视频的第一帧来代替。</li>
<li>preload: 属性规定在页面加载后载入视频。</li>
<li>webkit-playsinline和playsinline: 视频播放时局域播放，不脱离文档流 。但是这个属性比较特别， 需要嵌入网页的APP比如WeChat中UIwebview 的allowsInlineMediaPlayback = YES webview.allowsInlineMediaPlayback = YES，才能生效。换句话说，如果APP不设置，你页面中加了这标签也无效，这也就是为什么安卓手机WeChat 播放视频总是全屏，因为APP不支持playsinline，而ISO的WeChat却支持。<br>这里就要补充下，如果是想做全屏直播或者全屏H5体验的用户，IOS需要设置删除 webkit-playsinline 标签，因为你设置 false 是不支持的 ，安卓则不需要，因为默认全屏。但这时候全屏是有播放控件的，无论你有没有设置control。 做直播的可能用得着播放控件，但是全屏H5是不需要的，那么去除全屏播放时候的控件，需要以下设置：同层播放</li>
<li>x-webkit-airplay=”allow” : 这个属性应该是使此视频支持ios的AirPlay功能。使用AirPlay可以直接从使用iOS的设备上的不同位置播放视频、音乐还有照片文件，也就是说通过AirPlay功能可以实现影音文件的无线播放，当然前提是播放的终端设备也要支持相应的功能</li>
<li>x5-video-player-type: 启用同层H5播放器，就是在视频全屏的时候，div可以呈现在视频层上，也是WeChat安卓版特有的属性。同层播放别名也叫做沉浸式播放，播放的时候看似全屏，但是已经除去了control和微信的导航栏，只留下”X”和”&lt;”两键。目前的同层播放器只在Android（包括微信）上生效，暂时不支持iOS。至于为什么同层播放只对安卓开放，是因为安卓不能像ISO一样局域播放，默认的全屏会使得一些界面操作被阻拦，如果是全屏H5还好，但是做直播的话，诸如弹幕那样的功能就无法实现了，所以这时候同层播放的概念就解决了这个问题。不过在测试的过程中发现，不同版本的IOS和安卓效果略有不同</li>
<li>x5-video-orientation: 声明播放器支持的方向，可选值landscape 横屏, portraint竖屏。默认值portraint。无论是直播还是全屏H5一般都是竖屏播放，但是这个属性需要x5-video-player-type开启H5模式</li>
<li>x5­-video­-player­-fullscreen:全屏设置。它又两个属性值，ture和false，true支持全屏播放，false不支持全屏播放。其实，IOS 微信浏览器是Chrome的内核，相关的属性都支持，也是为什么X5同层播放不支持的原因。安卓微信浏览器是X5内核，一些属性标签比如playsinline就不支持，所以始终全屏。</li>
</ul>
<h3 id="全屏处理"><a href="#全屏处理" class="headerlink" title="全屏处理"></a>全屏处理</h3><ul>
<li><strong>ios</strong><br>ios加playsinline属性，之前只带webkit前缀的在ios10以后，会吊起系统自带播放器，两个属性都加上基本ios端都可以保证内敛到浏览器webview里面了。如果仍有个别版本的ios会吊起播放器，还可以引用一个库iphone-inline-video（具体用法很简单看它github，这里不介绍了，只需加js一句话，css加点），<a href="https://github.com/bfred-it/iphone-inline-video" target="_blank" rel="noopener">github地址</a>加上playsinline webkit-playsinline这两个属性和这个库基本可以保证ios端没有问题了（不过亲测，只加这两个属性不引入库好像也是ok的，至今没有在ios端微信没有出现问题，如果你要兼容uc或者qq的浏览器建议带上这个库）.</li>
<li><strong>android</strong><br>x5-video-player-type=”h5”属性，腾讯x5内核系的android微信和手Q内置浏览器用的浏览器webview的内核，使用这个属性在微信中视频会有不同的表现，会呈现全屏状态，貌似播放控件剥去了，至少加了这个属性后视频上层可以有其他dom元素出现了（非腾讯白名单机制的一种处理措施）。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">src</span>=<span class="string">"xx.mp4"</span> <span class="attr">playsinline</span> <span class="attr">webkit-playsinline</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="自动播放"><a href="#自动播放" class="headerlink" title="自动播放"></a>自动播放</h3><p>android始终不能自动播放，不多说。值得一提的是经测现在ios10后版本的safari和微信都不让视频自动播放了（顺带音频也不能自动播放了），但微信提供了一个事件WeixinJSBridgeReady，在微信嵌入webview全局的这个事件触发后，视频仍可以自动播放，这个应该是现在在ios端微信的视频自动播放的比较靠谱的方式，其他如手q或者其他浏览器，建议就引导用户出发触屏的行为操作出发比较好。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"WeixinJSBridgeReady"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123; </span><br><span class="line">    video.play();</span><br><span class="line">    video.pause();</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="播放控制"><a href="#播放控制" class="headerlink" title="播放控制"></a>播放控制</h3><p>对于video或者audio等媒体元素，有一些方法，常用的有play(),pause();也有一些事件，如’loadstart’,’canplay’,’canplaythrough’,’ended’,’timeupdate’…..等等。<br>在移动端有一些坑需要注意，不要轻易使用媒体元素的除’ended’,’timeupdate’以外event事件，在不同的机子上可能有不同的情况产生，例如：ios下监听’canplay’和’canplaythrough’（是否已缓冲了足够的数据可以流畅播放）,当加载时是不会触发的，即使preload=”auto”也没用，但在pc的chrome调试器下和android下，是会在加载阶段就触发。ios需要播放后才会触发。总之就是现在的视频标准还不尽完善，有很多坑要注意，要使用前最好自己亲测一遍<br>就是当第一次播放视频的时候ios端，如果网络慢，视频从开始播到能展现画面会有短暂的黑屏（处理视频源数据的时间），为了避免这个黑屏，可以在视频上加个div浮层（可以一个假的视频第一帧），然后用timeupdate方法监听，视屏播放及有画面的时候再移除浮层</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">video.addEventListener(<span class="string">'timeupdate'</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//当视频的currentTime大于0.1时表示黑屏时间已过，已有视频画面，可以移除浮层（.pagestart的div元素）</span></span><br><span class="line">    <span class="keyword">if</span> ( !video.isPlayed &amp;&amp; <span class="keyword">this</span>.currentTime&gt;<span class="number">0.1</span> )&#123;</span><br><span class="line">        $(<span class="string">'.pagestart'</span>).fadeOut(<span class="number">500</span>);</span><br><span class="line">        video.isPlayed = !<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="隐藏播放控件"><a href="#隐藏播放控件" class="headerlink" title="隐藏播放控件"></a>隐藏播放控件</h3><p>据说腾讯的android团队的x5内核团队放开了视频播放的限制，视频不一定调用它们那个备受诟病的视频播放器了，x5-video-player-type=”h5”属性这个属性好像就有点那个意思，虽然体验还是有点…（导航栏也会清理）但至少播放器控件没有了，上层可以浮div或者其他元素了，这个还是值得一提。还有一点值得说的是，带播放器控件的隐藏.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"videobox"</span> <span class="attr">ontouchmove</span>=<span class="string">"return false;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"mainvideo"</span> <span class="attr">src</span>=<span class="string">"test.mp4"</span> <span class="attr">x5-video-player-type</span>=<span class="string">"h5"</span> <span class="attr">playsinline</span> <span class="attr">webkit-playsinline</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>比如这个videobox在android下隐藏，只用display：none貌似还是不行的，但加个z-index:-1，设置成-1就可以达到隐藏播放器控件的目的了。</p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="https://segmentfault.com/a/1190000006857675" target="_blank" rel="noopener">html5–移动端视频video的android兼容，去除播放控件、全屏等</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video" target="_blank" rel="noopener">MDN-Video</a><br><a href="https://aotu.io/notes/2017/01/11/mobile-video/" target="_blank" rel="noopener">视频H5のVideo标签在微信里的坑和技巧</a><br><a href="http://www.xuanfengge.com/html5-video-play.html" target="_blank" rel="noopener">移动端HTML5<video>视频播放优化实践</video></a><br><a href="http://www.jianshu.com/p/9dec20414bb8" target="_blank" rel="noopener">微信端视频播放问题</a></p>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/视频播放-H5-video/">视频播放 H5 video</a></li></ul>

    </footer>
  
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/16/js-download-pdf/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          如何使用JavaScript下载文件
        
      </div>
    </a>
  
  
    <a href="/2017/12/16/JavaScript-functional/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">JavaScript 函数式编程&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="post-h5-video" data-title="视频H5 video标签最佳实践" data-url="https://gnipbao.github.io/2017/12/16/h5-video/"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
    var duoshuoQuery = {short_name:'gnip'};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
  <!-- 多说公共JS代码 end -->
</section>
</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Gnip&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo.</a>

    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>